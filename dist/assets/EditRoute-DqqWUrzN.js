import{r as a,j as t,k as c}from"./index-B9wrcDWQ.js";import{T as E}from"./TabContainer-DqSLoziL.js";import{T as y,S as b}from"./ToggleSwitch-0XDEILB1.js";import{B as I}from"./ButtonList-DgGakKsg.js";import{M,R as D}from"./RoutePlanner-DwyrQkHQ.js";import{P}from"./Container-Dk9VdPk9.js";import{P as w}from"./PageHeader-BHYpsllP.js";import{M as N}from"./MapContainer-BIFfYiqE.js";import{g as O}from"./url.service-CC_ivgR1.js";import{r as v}from"./route.service-CcB9DkO7.js";import{b as T}from"./stop.service-Yq49OPy_.js";import"./mapbox-gl-COE2yGkF.js";const X=()=>{var j,S;const u=O(),[R,p]=a.useState(!1),[l,m]=a.useState(null),[o,g]=a.useState({origin:null,destination:null}),[d,_]=a.useState([]),[f,h]=a.useState([]),[W,L]=a.useState(!0);a.useEffect(()=>{let e=!0;const i=async()=>{try{const s=await T.getAllBusStops();e&&_(s.busStops)}catch(s){console.error("Error fetching bus stops:",s.message)}},n=async()=>{try{const s=await v.getRouteById(u);if(!s)return;m(s),g({origin:s.origin,destination:s.destination});const r=s.stops.map(B=>B.stopId);h(r)}catch(s){console.error("Error fetching route details:",s)}};return i().then(n),()=>{e=!1}},[]);const x=(e,i=!0)=>{const n=d.find(r=>r._id===e.target.value),s=i?"origin":"destination";n&&g(r=>({...r,[s]:{name:n.name,_id:n._id}})),console.log(o)},k=async()=>{if(!o.origin||!o.destination||!l){c.error("Please enter origin, destination, and generate a route.");return}const e={routeName:`${o.origin.name} to ${o.destination.name}`,origin:o.origin._id,destination:o.destination._id,totalDistance:l.distance,totalDuration:l.duration,stops:f.map((i,n)=>({stopId:i._id,stopOrder:n+1}))};console.log(e);try{await v.updateRoute(u,e),c.success("Route updated successfully!")}catch(i){console.error("Error updating route:",i),c.error("Failed to update route. Please try again.")}},C=e=>{m(e)};return t.jsxs(P,{children:[t.jsx(w,{title:"Edit Route",description:"Modify the route details and waypoints",buttons:[{id:"edit-route",label:"Save Changes"}],goBack:!0,onButtonClick:k}),t.jsx(E,{children:t.jsx(y,{children:t.jsx(y.Item,{title:"Route",children:t.jsxs("div",{className:"space-y-6 w-96 relative",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Origin"}),t.jsxs(b,{onChange:e=>x(e,!0),value:((j=o.origin)==null?void 0:j._id)||"",children:[t.jsx("option",{value:"",disabled:!0,children:"Select an origin"}),d.map(e=>t.jsx("option",{value:e._id,children:e.name},e._id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Destination"}),t.jsxs(b,{onChange:e=>x(e,!1),value:((S=o.destination)==null?void 0:S._id)||"",children:[t.jsx("option",{value:"",disabled:!0,children:"Select a destination"}),d.map(e=>t.jsx("option",{value:e._id,children:e.name},e._id))]})]}),t.jsx(I,{label:"Edit Route",startIcon:"majesticons:map-marker",onClick:()=>p(!0),disabled:!o.origin||!o.destination})]})})})}),t.jsx(M,{isModalOpen:R,onButtonClick:()=>p(!1),children:t.jsx(N,{children:e=>t.jsx(D,{mapInstance:e,origin:o.origin,destination:o.destination,busStops:d,waypoints:f,setWaypoints:h,onWaypointsUpdated:C})})})]})};export{X as default};
