import{c as P,u as q,r as i,j as e,k as b}from"./index-B9wrcDWQ.js";import{u as A}from"./url.service-CC_ivgR1.js";import{r as R}from"./route.service-CcB9DkO7.js";import{b as k}from"./bus.service-DtEzQnLH.js";import{s as p}from"./scheduledBus.service-ImcWo4LN.js";import{d as L}from"./driver.service-CPuDNPLc.js";import{A as z,T,L as d,S as m,a as O,B as H,b as U}from"./ToggleSwitch-0XDEILB1.js";import{P as G}from"./Container-Dk9VdPk9.js";import{P as J}from"./PageHeader-BHYpsllP.js";import{T as K}from"./TabContainer-DqSLoziL.js";import"./ButtonList-DgGakKsg.js";const M=l=>{if(!l)return"";const o=new Date(l);return new Date(o.getTime()-o.getTimezoneOffset()*6e4).toISOString().slice(0,16)},le=()=>{const{id:l}=P(),o=A.getId(),x=q(),[a,j]=i.useState({bus:"",driver:"",route:"",scheduleTime:"",status:""}),[B,D]=i.useState([]),[y,C]=i.useState([]),[_,w]=i.useState([]),[S,n]=i.useState(!1),[f,g]=i.useState(null);i.useEffect(()=>{(async()=>{var r,c,h;try{n(!0);const[v,N,I]=await Promise.all([k.getAllBuses(),L.getAllDrivers(),R.getAllRoutes()]);if(D(v.buses),C(N),w(I),l){const t=await p.getScheduledBusById(l);j({bus:((r=t==null?void 0:t.bus)==null?void 0:r._id)||"",driver:((c=t==null?void 0:t.driver)==null?void 0:c._id)||"",route:((h=t==null?void 0:t.route)==null?void 0:h._id)||"",scheduleTime:t!=null&&t.scheduleTime?M(t.scheduleTime):"",status:(t==null?void 0:t.status)||"Scheduled"})}}catch(v){g(v.message)}finally{n(!1)}})()},[l]);const u=s=>{const{name:r,value:c}=s.target;j(h=>({...h,[r]:c}))},E=async s=>{s.preventDefault();try{n(!0),await p.updateScheduledBus(l,a),x(-1)}catch(r){g(r.message)}finally{n(!1)}},F=async s=>{if(s=="delete")try{await p.deleteScheduledBus(o),b.success("Schedule has been deleted"),x(-1)}catch(r){console.error("Failed deleting schedule: ",r.message),b.error("Failed to delete the schedule")}};return e.jsxs(G,{children:[e.jsx(J,{title:"Edit Schedule",description:"Edit fields to update the schedule",buttons:[{id:"delete",label:"Delete",icon:"material-symbols:delete-outline-rounded"}],onButtonClick:F,goBack:!0}),f&&e.jsx(z,{color:"failure",children:f}),e.jsx(K,{children:e.jsx(T,{children:e.jsx(T.Item,{title:"Bus Schedule",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"bus",value:"Bus"}),e.jsxs(m,{id:"bus",name:"bus",value:a.bus,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Bus"}),B.map(s=>e.jsx("option",{value:s._id,children:s==null?void 0:s.busNumber},s._id))]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"driver",value:"Driver"}),e.jsxs(m,{id:"driver",name:"driver",value:a.driver,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Driver"}),y.map(s=>e.jsxs("option",{value:s._id,children:[s.firstName," ",s.lastName]},s._id))]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"route",value:"Route"}),e.jsxs(m,{id:"route",name:"route",value:a.route,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Route"}),_.map(s=>e.jsx("option",{value:s._id,children:s.routeName},s._id))]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"scheduleTime",value:"Schedule Time"}),e.jsx(O,{type:"datetime-local",id:"scheduleTime",name:"scheduleTime",value:a.scheduleTime,onChange:u,required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"status",value:"Status"}),e.jsxs(m,{id:"status",name:"status",value:a.status,onChange:u,required:!0,children:[e.jsx("option",{value:"Scheduled",children:"Scheduled"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),e.jsx(H,{type:"submit",color:"blue",disabled:S,className:"w-full",children:S?e.jsx(U,{size:"sm"}):"Update Schedule"})]})})})})]})};export{le as default};
