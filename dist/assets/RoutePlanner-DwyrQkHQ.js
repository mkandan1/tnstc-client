import{j as a,t as M,r as m}from"./index-B9wrcDWQ.js";import{P}from"./PageHeader-BHYpsllP.js";import{m as x}from"./mapbox-gl-COE2yGkF.js";import{B as W}from"./ButtonList-DgGakKsg.js";const T=({children:o,isModalOpen:s,onButtonClick:l})=>{const n=[{id:"close-model",label:"Close",icon:"ep:close-bold"}];return a.jsxs("div",{className:M(`${s?"opacity-100 z-50":"opacity-0 -z-10 -translate-y-52"} transition-all duration-500 shadow-xl bg-white w-full h-full absolute -top-2 bottom-0 left-0 right-0`,"px-3"),children:[a.jsx(P,{title:"Route Creation",buttons:n,onButtonClick:l}),o]})},g="pk.eyJ1IjoibWFuaWthbmRhbnAiLCJhIjoiY202bmlmMmx0MHAwZjJzc20xaXUyYTVzbCJ9.4Mr0vQPzC____dvSfo_Bhg",$=({mapInstance:o,origin:s,destination:l,busStops:n,onWaypointsUpdated:w,waypoints:y,setWaypoints:j})=>{const[C,v]=m.useState([]),[_,R]=m.useState(0),[S,N]=m.useState(0),[i,k]=m.useState([]);m.useEffect(()=>{if(!o||!s||!l||!n)return;D(n),k(y.filter(e=>(e==null?void 0:e._id)!==(s==null?void 0:s._id)&&(e==null?void 0:e._id)!==(l==null?void 0:l._id)));const r=[s,...i,l];f(r)},[o,s,l,n,y]);const f=r=>{if(!o||r.length<2)return;const c=`https://api.mapbox.com/directions/v5/mapbox/driving/${r.map(t=>{var u,d;return[(u=t==null?void 0:t.coordinates)==null?void 0:u.lng,(d=t==null?void 0:t.coordinates)==null?void 0:d.lat]}).join(";")}.json?access_token=${g}&geometries=geojson&overview=full&alternatives=false`;fetch(c).then(t=>t.json()).then(t=>{const u=t.routes[0].geometry.coordinates;F(u),v([{route:u,id:Date.now()}]);const d=(t.routes[0].distance/1e3).toFixed(2),b=(t.routes[0].duration/60).toFixed(2);R(d),N(b),w({waypoints:r.map(h=>h==null?void 0:h._id),distance:parseFloat(d),duration:parseFloat(b)})}).catch(t=>console.error("Error fetching directions:",t))},D=r=>{if(o)try{r.forEach(e=>{var c,t;new x.Marker({color:"red"}).setLngLat([(c=e==null?void 0:e.coordinates)==null?void 0:c.lng,(t=e==null?void 0:e.coordinates)==null?void 0:t.lat]).setPopup(new x.Popup().setText(`Bus Stop: ${e==null?void 0:e.name}`)).addTo(o).getElement().addEventListener("click",()=>{j(u=>{const d=[...u,e];return f([s,...d,l]),d})})})}catch(e){console.error(e)}},E=r=>{j(e=>{const c=e.filter((t,u)=>u!==r);return f([s,...c,l]),c})},F=r=>{if(!o)return;const e="route-source",c="route-layer";o.getSource(e)?o.getSource(e).setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:r}}):(x.accessToken=g,o.addSource(e,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:r}}}),o.addLayer({id:c,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff0000","line-width":4}}))};return a.jsxs("div",{className:"w-80 h-full bg-white shadow-lg border absolute bottom-0 top-0 right-0 p-4 flex flex-col",children:[a.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Route Information"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Distance: ",_," km"]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Duration: ",S," mins"]}),a.jsx("div",{className:"mt-4 w-full flex-1 overflow-y-auto border rounded p-2 font-mono",children:[s,...i,l].length===0?a.jsx("p",{className:"text-gray-500",children:"No stops added yet."}):[s,...i,l].map((r,e)=>a.jsxs("div",{className:"flex w-full justify-between items-center p-2 bg-gray-100 rounded mb-2",children:[a.jsxs("span",{className:"text-sm font-medium",children:[e+1,". ",r==null?void 0:r.name]}),e!==0&&e!==i.length+1&&a.jsx("div",{children:a.jsx(W,{intent:"destructive",onClick:()=>E(e),startIcon:"material-symbols:delete-rounded"})})]},e))})]})};export{T as M,$ as R};
