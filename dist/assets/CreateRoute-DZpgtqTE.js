import{r as n,j as t,k as c}from"./index-B9wrcDWQ.js";import{T as P}from"./TabContainer-DqSLoziL.js";import{T as j,a as b}from"./ToggleSwitch-0XDEILB1.js";import{B as D}from"./ButtonList-DgGakKsg.js";import{M as T,R as U}from"./RoutePlanner-DwyrQkHQ.js";import{P as L}from"./Container-Dk9VdPk9.js";import{P as O}from"./PageHeader-BHYpsllP.js";import{M as A}from"./MapContainer-BIFfYiqE.js";import{r as F}from"./route.service-CcB9DkO7.js";import{b as W}from"./stop.service-Yq49OPy_.js";import"./mapbox-gl-COE2yGkF.js";const Z=()=>{var v,S;const[o,u]=n.useState({origin:"",destination:""}),[d,p]=n.useState([]),[m,g]=n.useState([]),[w,h]=n.useState(!1),[f,C]=n.useState([]),[k,R]=n.useState([]),[z,B]=n.useState(!0),[l,I]=n.useState();n.useEffect(()=>{let e=!0;return(async()=>{try{const a=await W.getAllBusStops();if(e){const i=a.busStops.map(r=>({...r,active:r.active?"Active":"Inactive"}));C(i)}}catch(a){console.error("Error fetching bus stops:",a.message)}finally{e&&B(!1)}})(),()=>{e=!1}},[]);const N=e=>f.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())),x=(e,s,a=!0)=>{const{value:i}=e.target;if(u(r=>({...r,[a?"origin":"destination"]:i})),i.length<2)s([]);else{const r=N(i);s(r)}},y=(e,s=!0)=>{u(a=>({...a,[s?"origin":"destination"]:e})),s?p([]):g([])},E=async()=>{if(!o.origin||!o.destination||!l){c.error("Please enter origin, destination, and generate a route.");return}const e={routeName:`${o.origin.name} to ${o.destination.name}`,origin:o.origin._id,destination:o.destination._id,totalDistance:l.distance,totalDuration:l.duration,stops:l.waypoints.map((s,a)=>({stopId:s,stopOrder:a+1})),routeType:"Urban",isActive:!0};try{const s=await F.createRoute(e);c.success("Route saved successfully!"),console.log("Saved route:",s)}catch(s){console.error("Error saving route:",s),c.error("Failed to save route. Please try again.")}},M=e=>{console.log("Updated waypoints: ",e),I(e)};return t.jsxs(L,{children:[t.jsx(O,{title:"Create Route",description:"Fill in the details to create a new route",buttons:[{id:"create-route",label:"Save Route"}],goBack:!0,onButtonClick:()=>E()}),t.jsx(P,{children:t.jsx(j,{children:t.jsx(j.Item,{title:"Route",children:t.jsxs("div",{className:"space-y-6 w-96 relative",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Enter origin"}),t.jsx(b,{type:"text",placeholder:"Origin",value:(v=o.origin)==null?void 0:v.name,onChange:e=>x(e,p,!0)}),d.length>0&&t.jsx("ul",{className:"absolute z-10 bg-white shadow-lg w-full mt-1 max-h-60 overflow-auto",children:d.map((e,s)=>t.jsx("li",{className:"px-4 py-2 cursor-pointer hover:bg-gray-200",onClick:()=>y(e,!0),children:e.name},s))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Enter destination"}),t.jsx(b,{type:"text",placeholder:"Destination",value:(S=o.destination)==null?void 0:S.name,onChange:e=>x(e,g,!1)}),m.length>0&&t.jsx("ul",{className:"absolute z-10 bg-white shadow-lg w-full mt-1 max-h-60 overflow-auto",children:m.map((e,s)=>t.jsx("li",{className:"px-4 py-2 cursor-pointer hover:bg-gray-200",onClick:()=>y(e,!1),children:e.name},s))})]}),t.jsx(D,{label:"Fetch map",startIcon:"majesticons:map-marker",onClick:()=>{o.origin&&o.destination&&h(!0)},disabled:!o.origin||!o.destination})]})})})}),t.jsx(T,{isModalOpen:w,onButtonClick:()=>h(!1),children:t.jsx(A,{children:e=>t.jsx(U,{mapInstance:e,origin:o.origin,destination:o.destination,busStops:f,waypoints:k,setWaypoints:R,onWaypointsUpdated:M})})})]})};export{Z as default};
